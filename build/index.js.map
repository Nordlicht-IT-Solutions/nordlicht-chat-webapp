{"version":3,"sources":["../webpack/universalModuleDefinition","../webpack/bootstrap","../external \"react\"","../external \"react-dom\"","lib/components/JoinRoomDialog.tsx","lib/components/FindUserDialog.tsx","lib/components/DrawerContent.tsx","lib/components/ChatInput.tsx","lib/components/Messages.tsx","lib/components/Chat.tsx","lib/components/Login.tsx","lib/components/reducer.ts","lib/components/App.tsx"],"names":["root","factory","exports","module","require","define","amd","a","i","this","__WEBPACK_EXTERNAL_MODULE__0__","__WEBPACK_EXTERNAL_MODULE__11__","webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","0","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","oldJsonpFunction","slice","JoinRoomDialog","open","onClose","client","joinedRooms","useState","room","setRoom","rooms","setRooms","useEffect","then","jrs","Set","filter","has","startsWith","sort","handleClose","useCallback","handleSubmit","e","preventDefault","undefined","Dialog","onSubmit","DialogTitle","DialogContent","DialogContentText","Autocomplete","freeSolo","autoSelect","options","renderInput","params","TextField","label","variant","margin","fullWidth","onChange","_","multiple","DialogActions","Button","type","autoFocus","onClick","color","FindUserDialog","knownUsers","user","setUser","users","setUsers","kus","disabled","useStyles","makeStyles","theme","subheaderWithButton","display","justifyContent","DrawerContent","activeRoom","onRoomSelect","onLogOut","handleRoomClick","currentTarget","dataset","id","React","anchorEl","setAnchorEl","Boolean","handleMenu","event","handleLogOut","showJoinRoomDialog","setShowJoinRoomDialog","handleJoinRoom","handleJoinRoomDialogClose","roomId","res","console","info","catch","err","error","showFindUserDialog","setShowFindUserDialog","handleFindContact","handleFindUserDialogClose","userToAdd","join","classes","keys","map","replace","AppBar","position","Toolbar","startIcon","AccountCircle","aria-label","aria-controls","aria-haspopup","Menu","anchorOrigin","vertical","horizontal","keepMounted","transformOrigin","MenuItem","Divider","List","dense","subheader","ListSubheader","className","IconButton","edge","GroupAdd","ListItem","button","data-id","selected","ListItemIcon","Group","ListItemText","ListItemSecondaryAction","getUnreadComponent","PersonAdd","Person","count","events","evt","ts","lastRead","Chip","size","ChatInput","selectedRoom","msg","setMsg","handleMsgChange","target","message","noValidate","autoComplete","createStyles","toolbar","mixins","content","flexGrow","flexDirection","messages","flex","overflowY","minHeight","df1","Intl","DateTimeFormat","hour","minute","second","df2","year","month","day","EventTime","roomEvent","now","Date","isToday","getDate","getMonth","getFullYear","Typography","format","Messages","roomEvents","messagesRef","useRef","useLayoutEffect","current","scrollTop","scrollHeight","useMemo","Grid","item","sender","container","direction","JSON","stringify","ref","Box","marginTop","marginBottom","spacing","paddingTop","height","drawer","breakpoints","up","width","flexShrink","appBar","marginLeft","menuButton","marginRight","drawerPaper","title","Chat","singleRoomLog","useTheme","drawerOpened","setDrawerOpened","handleDrawerClose","handleMenuButtonClick","handleRoomSelect","roomName","handleLeaveRoom","log","showRoomMembers","setShowRoomMembers","handleShowRoomMembers","handleShowRoomMembersDialogClose","handleAddClick","userName","u","some","split","includes","fontSize","Settings","Hidden","smUp","implementation","Drawer","anchor","paper","ModalProps","xsDown","alignItems","avatar","backgroundColor","palette","secondary","main","form","submit","Login","onLogin","password","setPassword","handleUserChange","handlePasswordChange","Container","component","maxWidth","Avatar","LockOutlined","required","xs","Link","href","enableMapSet","initialState","loginInProgress","authData","connectionState","connectionReason","reducer","state","action","produce","draft","assign","payload","add","delete","code","Error","createMuiTheme","primary","red","backdrop","zIndex","App","useReducer","dispatch","timeoutRef","ws","WebSocket","window","location","protocol","port","host","calls","Map","callId","addEventListener","localStorage","getItem","finally","parse","method","jsonrpc","reject","resolve","values","setTimeout","clearTimeout","Promise","send","set","handleLogin","setItem","close","removeItem","connSpecial","special","stateMapping","ThemeProvider","CssBaseline","Backdrop","Paper","elevation","padding","closed","connecting","closing","connected"],"mappings":"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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"react\"), require(\"react-dom\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"react\", \"react-dom\"], factory);\n\telse {\n\t\tvar a = typeof exports === 'object' ? factory(require(\"react\"), require(\"react-dom\")) : factory(root[\"react\"], root[\"react-dom\"]);\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(this, function(__WEBPACK_EXTERNAL_MODULE__0__, __WEBPACK_EXTERNAL_MODULE__11__) {\nreturn "," \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t0: 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \tvar jsonpArray = this[\"webpackJsonpmy-lib\"] = this[\"webpackJsonpmy-lib\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([88,1]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","module.exports = __WEBPACK_EXTERNAL_MODULE__0__;","module.exports = __WEBPACK_EXTERNAL_MODULE__11__;","import React, { useCallback, useState, useEffect } from 'react';\nimport {\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  Button,\n  TextField,\n  DialogContentText,\n} from '@material-ui/core';\n\nimport Autocomplete from '@material-ui/lab/Autocomplete';\n\ntype Props = {\n  open: boolean;\n  onClose: (room?: string) => void;\n  client: Client;\n  joinedRooms: string[];\n};\n\nexport const JoinRoomDialog: React.FC<Props> = ({\n  open,\n  onClose,\n  client,\n  joinedRooms,\n}) => {\n  const [room, setRoom] = useState('');\n\n  const [rooms, setRooms] = useState<string[]>([]);\n\n  useEffect(() => {\n    if (open) {\n      client.call('getRooms', []).then((rooms: string[]) => {\n        const jrs = new Set(joinedRooms);\n\n        setRooms(\n          rooms.filter(room => !jrs.has(room) && !room.startsWith('!')).sort(),\n        );\n      });\n\n      setRoom('');\n    }\n  }, [client, open, joinedRooms]);\n\n  const handleClose = useCallback(() => {\n    onClose();\n  }, [onClose]);\n\n  const handleSubmit = useCallback(\n    (e: React.FormEvent) => {\n      e.preventDefault();\n      onClose(room || undefined);\n    },\n    [onClose, room],\n  );\n\n  return (\n    <Dialog open={open} onClose={handleClose}>\n      <form onSubmit={handleSubmit}>\n        <DialogTitle>Which room to join?</DialogTitle>\n        <DialogContent>\n          <DialogContentText>\n            Select existing or create new room.\n          </DialogContentText>\n          <Autocomplete\n            freeSolo\n            autoSelect\n            options={rooms}\n            renderInput={params => (\n              <TextField\n                {...params}\n                label=\"Room\"\n                variant=\"outlined\"\n                margin=\"dense\"\n                fullWidth\n              />\n            )}\n            onChange={(_, value) => {\n              if (value) {\n                setRoom(value);\n              }\n            }}\n            multiple={false}\n          />\n        </DialogContent>\n        <DialogActions>\n          <Button type=\"button\" autoFocus onClick={handleClose} color=\"primary\">\n            Cancel\n          </Button>\n          <Button\n            type=\"submit\"\n            color=\"primary\"\n            autoFocus\n            // disabled={!room}\n          >\n            Join\n          </Button>\n        </DialogActions>\n      </form>\n    </Dialog>\n  );\n};\n","import React, { useCallback, useState, useEffect } from 'react';\n\nimport {\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  Button,\n  TextField,\n  DialogContentText,\n} from '@material-ui/core';\n\nimport Autocomplete from '@material-ui/lab/Autocomplete';\n\ntype Props = {\n  open: boolean;\n  onClose: (user?: string) => void;\n  client: Client;\n  knownUsers: string[];\n};\n\nexport const FindUserDialog: React.FC<Props> = ({\n  open,\n  onClose,\n  client,\n  knownUsers,\n}) => {\n  const [user, setUser] = useState('');\n\n  const [users, setUsers] = useState<string[]>([]);\n\n  useEffect(() => {\n    if (open) {\n      client.call('getUsers', []).then((users: string[]) => {\n        const kus = new Set(knownUsers);\n\n        setUsers(users.filter(user => !kus.has(user)).sort());\n      });\n\n      setUser('');\n    }\n  }, [client, open, knownUsers]);\n\n  const handleClose = useCallback(() => {\n    onClose();\n  }, [onClose]);\n\n  const handleSubmit = useCallback(\n    (e: React.FormEvent) => {\n      e.preventDefault();\n      onClose(user || undefined);\n    },\n    [onClose, user],\n  );\n\n  return (\n    <Dialog open={open} onClose={handleClose}>\n      <form onSubmit={handleSubmit}>\n        <DialogTitle>Which user to contact?</DialogTitle>\n        <DialogContent>\n          <DialogContentText>Find user to contact.</DialogContentText>\n          <Autocomplete\n            options={users}\n            renderInput={params => (\n              <TextField\n                {...params}\n                label=\"Contact name\"\n                variant=\"outlined\"\n                margin=\"dense\"\n                fullWidth\n              />\n            )}\n            onChange={(_, value) => {\n              if (value) {\n                setUser(value);\n              }\n            }}\n            multiple={false}\n          />\n        </DialogContent>\n        <DialogActions>\n          <Button type=\"button\" autoFocus onClick={handleClose} color=\"primary\">\n            Cancel\n          </Button>\n          <Button type=\"submit\" color=\"primary\" autoFocus disabled={!user}>\n            Add contact\n          </Button>\n        </DialogActions>\n      </form>\n    </Dialog>\n  );\n};\n","import React, { useCallback, MouseEventHandler, useState } from 'react';\n\nimport {\n  List,\n  ListItem,\n  ListItemText,\n  makeStyles,\n  AppBar,\n  Toolbar,\n  Button,\n  Menu,\n  MenuItem,\n  ListSubheader,\n  Divider,\n  ListItemIcon,\n  IconButton,\n  Chip,\n  ListItemSecondaryAction,\n} from '@material-ui/core';\n\nimport {\n  AccountCircle,\n  GroupAdd,\n  Group,\n  PersonAdd,\n  Person,\n} from '@material-ui/icons';\n\nimport { JoinRoomDialog } from './JoinRoomDialog';\nimport { FindUserDialog } from './FindUserDialog';\n\ntype Props = {\n  activeRoom: string | undefined;\n  rooms: Rooms;\n  onRoomSelect: (room: string) => void;\n  user: string;\n  onLogOut: () => void;\n  client: Client;\n};\n\nconst useStyles = makeStyles(theme => ({\n  subheaderWithButton: { display: 'flex', justifyContent: 'space-between' },\n}));\n\nexport const DrawerContent: React.FC<Props> = ({\n  activeRoom,\n  rooms,\n  onRoomSelect,\n  user,\n  onLogOut,\n  client,\n}) => {\n  const handleRoomClick: MouseEventHandler<HTMLElement> = useCallback(\n    e => {\n      onRoomSelect(e.currentTarget.dataset.id as string);\n    },\n    [onRoomSelect],\n  );\n\n  const [anchorEl, setAnchorEl] = React.useState<null | HTMLElement>(null);\n\n  const open = Boolean(anchorEl);\n\n  const handleMenu = useCallback((event: React.MouseEvent<HTMLElement>) => {\n    setAnchorEl(event.currentTarget);\n  }, []);\n\n  const handleClose = useCallback(() => {\n    setAnchorEl(null);\n  }, []);\n\n  const handleLogOut = useCallback(() => {\n    setAnchorEl(null);\n    onLogOut();\n  }, [onLogOut]);\n\n  const [showJoinRoomDialog, setShowJoinRoomDialog] = useState(false);\n\n  const handleJoinRoom = useCallback(() => {\n    setAnchorEl(null);\n    setShowJoinRoomDialog(true);\n  }, []);\n\n  const handleJoinRoomDialogClose = useCallback(\n    (roomId?: string) => {\n      setShowJoinRoomDialog(false);\n\n      if (!roomId) {\n        return;\n      }\n\n      client\n        .call('joinRoom', [roomId])\n        .then((res: any) => {\n          console.info('JOIN ROOM', res);\n          onRoomSelect(roomId);\n        })\n        .catch((err: any) => {\n          console.error('JOIN ROOM', err);\n        })\n        .then(() => {\n          setAnchorEl(null);\n        });\n    },\n    [client, onRoomSelect],\n  );\n\n  const [showFindUserDialog, setShowFindUserDialog] = useState(false);\n\n  const handleFindContact = useCallback(() => {\n    setAnchorEl(null);\n    setShowFindUserDialog(true);\n  }, []);\n\n  const handleFindUserDialogClose = useCallback(\n    (userToAdd?: string) => {\n      setShowFindUserDialog(false);\n\n      if (!userToAdd) {\n        return;\n      }\n\n      const room = `!${[userToAdd, user].sort().join('!')}`;\n\n      client\n        .call('joinRoom', [room])\n        .then((res: any) => {\n          console.info('ADD CONTACT', res);\n          onRoomSelect(room);\n        })\n        .catch((err: any) => {\n          console.error('ADD CONTACT', err);\n        })\n        .then(() => {\n          setAnchorEl(null);\n        });\n    },\n    [client, onRoomSelect, user],\n  );\n\n  const classes = useStyles();\n\n  return (\n    <div>\n      <JoinRoomDialog\n        client={client}\n        open={showJoinRoomDialog}\n        onClose={handleJoinRoomDialogClose}\n        joinedRooms={Object.keys(rooms)}\n      />\n      <FindUserDialog\n        client={client}\n        open={showFindUserDialog}\n        onClose={handleFindUserDialogClose}\n        knownUsers={[\n          user,\n          ...Object.keys(rooms)\n            .filter(room => room.startsWith('!'))\n            .map(room => room.replace(`!${user}`, '').slice(1)),\n        ]}\n      />\n      <AppBar position=\"static\">\n        <Toolbar>\n          <Button\n            startIcon={<AccountCircle />}\n            aria-label=\"account of current user\"\n            aria-controls=\"menu-appbar\"\n            aria-haspopup=\"true\"\n            onClick={handleMenu}\n            color=\"inherit\"\n          >\n            {user}\n          </Button>\n          <Menu\n            id=\"menu-appbar\"\n            anchorEl={anchorEl}\n            anchorOrigin={{\n              vertical: 'top',\n              horizontal: 'right',\n            }}\n            keepMounted\n            transformOrigin={{\n              vertical: 'top',\n              horizontal: 'right',\n            }}\n            open={open}\n            onClose={handleClose}\n          >\n            <MenuItem onClick={handleLogOut}>Log out</MenuItem>\n          </Menu>\n        </Toolbar>\n      </AppBar>\n      <Divider />\n      <List\n        dense\n        subheader={\n          <ListSubheader className={classes.subheaderWithButton}>\n            <div>Joined rooms</div>\n            <IconButton onClick={handleJoinRoom} edge=\"end\">\n              <GroupAdd />\n            </IconButton>\n          </ListSubheader>\n        }\n      >\n        {Object.keys(rooms)\n          .filter(name => !name.startsWith('!'))\n          .sort()\n          .map(name => (\n            <ListItem\n              key={name}\n              button\n              data-id={name}\n              onClick={handleRoomClick}\n              selected={name === activeRoom}\n            >\n              <ListItemIcon>\n                <Group />\n              </ListItemIcon>\n              <ListItemText>{name}</ListItemText>\n              <ListItemSecondaryAction>\n                {getUnreadComponent(rooms, name)}\n              </ListItemSecondaryAction>\n            </ListItem>\n          ))}\n      </List>\n      <Divider />\n      <List\n        dense\n        subheader={\n          <ListSubheader className={classes.subheaderWithButton}>\n            <div>Contacts</div>\n            <IconButton onClick={handleFindContact} edge=\"end\">\n              <PersonAdd />\n            </IconButton>\n          </ListSubheader>\n        }\n      >\n        {Object.keys(rooms)\n          .filter(name => name.startsWith('!'))\n          .sort()\n          .map(name => {\n            return (\n              <ListItem\n                key={name}\n                button\n                data-id={name}\n                onClick={handleRoomClick}\n                selected={name === activeRoom}\n              >\n                <ListItemIcon>\n                  <Person />\n                </ListItemIcon>\n                <ListItemText>\n                  {name.replace(`!${user}`, '').slice(1)}\n                </ListItemText>\n                <ListItemSecondaryAction>\n                  {getUnreadComponent(rooms, name)}\n                </ListItemSecondaryAction>\n              </ListItem>\n            );\n          })}\n      </List>\n    </div>\n  );\n};\n\nfunction getUnreadComponent(rooms: Rooms, name: string) {\n  const count = rooms[name].events.filter(evt => evt.ts > rooms[name].lastRead)\n    .length;\n\n  return count ? <Chip label={count} size=\"small\" color=\"primary\" /> : null;\n}\n","import React, { useState, useCallback, ChangeEvent, FormEvent } from 'react';\n\nimport { TextField } from '@material-ui/core';\n\ntype Props = {\n  client: Client;\n  selectedRoom: string | undefined;\n};\n\nconst ChatInput: React.FC<Props> = ({ client, selectedRoom }) => {\n  const [msg, setMsg] = useState('');\n\n  const handleMsgChange = useCallback((e: ChangeEvent) => {\n    setMsg((e.target as HTMLInputElement).value);\n  }, []);\n\n  const handleSubmit = useCallback(\n    (e: FormEvent) => {\n      e.preventDefault();\n\n      if (msg && selectedRoom) {\n        client.call('sendMessage', {\n          room: selectedRoom,\n          message: msg,\n        });\n\n        setMsg('');\n      }\n    },\n    [msg, selectedRoom, client],\n  );\n\n  return (\n    <form noValidate autoComplete=\"off\" onSubmit={handleSubmit}>\n      <TextField\n        fullWidth\n        label=\"Message\"\n        variant=\"outlined\"\n        value={msg}\n        onChange={handleMsgChange}\n        size=\"small\"\n        autoFocus\n        // multiline\n      />\n    </form>\n  );\n};\n\nexport default ChatInput;\n","import React, { Fragment, useRef, useLayoutEffect, useMemo } from 'react';\n\nimport {\n  Grid,\n  Box,\n  makeStyles,\n  createStyles,\n  Typography,\n} from '@material-ui/core';\n\nimport ChatInput from './ChatInput';\n\nconst useStyles = makeStyles(theme =>\n  createStyles({\n    toolbar: theme.mixins.toolbar,\n    content: {\n      flexGrow: 1,\n      // padding: theme.spacing(3),\n\n      display: 'flex',\n      flexDirection: 'column',\n    },\n    messages: {\n      flex: '1 1 auto',\n      overflowY: 'auto',\n      minHeight: 0,\n\n      display: 'flex',\n      flexDirection: 'column',\n    },\n  }),\n);\n\ntype Props = {\n  client: Client;\n  roomEvents: RoomEvent[];\n  selectedRoom: string | undefined;\n};\n\nconst df1 = new Intl.DateTimeFormat('default', {\n  hour: 'numeric',\n  minute: 'numeric',\n  second: 'numeric',\n});\n\nconst df2 = new Intl.DateTimeFormat('default', {\n  year: 'numeric',\n  month: 'numeric',\n  day: 'numeric',\n  hour: 'numeric',\n  minute: 'numeric',\n  second: 'numeric',\n});\n\nconst EventTime: React.FC<{ roomEvent: RoomEvent }> = ({ roomEvent }) => {\n  const now = new Date();\n  const then = new Date(roomEvent.ts);\n\n  const isToday =\n    now.getDate() === then.getDate() &&\n    now.getMonth() === then.getMonth() &&\n    now.getFullYear() === then.getFullYear();\n\n  return (\n    <Typography variant=\"caption\" color=\"textSecondary\" display=\"inline\">\n      <small>{(isToday ? df1 : df2).format(roomEvent.ts)}</small>\n    </Typography>\n  );\n};\n\nconst Messages: React.FC<Props> = ({ client, roomEvents, selectedRoom }) => {\n  const messagesRef = useRef<HTMLDivElement>(null);\n\n  useLayoutEffect(() => {\n    if (messagesRef.current) {\n      messagesRef.current.scrollTop = messagesRef.current.scrollHeight;\n    }\n  }, [roomEvents]);\n\n  const classes = useStyles();\n\n  const messages = useMemo(\n    () =>\n      (roomEvents ?? []).map(roomEvent => (\n        <Fragment key={roomEvent.id}>\n          {roomEvent.type === 'join' ? (\n            <Grid item>\n              <Typography\n                color=\"textSecondary\"\n                variant=\"body2\"\n                display=\"inline\"\n              >\n                <b>{roomEvent.sender}</b> joined{' '}\n              </Typography>\n              <EventTime roomEvent={roomEvent} />\n            </Grid>\n          ) : roomEvent.type === 'leave' ? (\n            <Grid item>\n              <Typography\n                color=\"textSecondary\"\n                variant=\"body2\"\n                display=\"inline\"\n              >\n                <b>{roomEvent.sender}</b> left{' '}\n                <EventTime roomEvent={roomEvent} />\n              </Typography>\n            </Grid>\n          ) : roomEvent.type === 'message' ? (\n            <Grid item container direction=\"column\">\n              <Grid item>\n                <Typography\n                  variant=\"subtitle2\"\n                  color=\"textPrimary\"\n                  display=\"inline\"\n                >\n                  {roomEvent.sender}\n                </Typography>{' '}\n                <EventTime roomEvent={roomEvent} />\n              </Grid>\n              <Grid item>{roomEvent.message}</Grid>\n            </Grid>\n          ) : (\n            <Grid item>{JSON.stringify(roomEvent)} </Grid>\n          )}\n        </Fragment>\n      )),\n    [roomEvents],\n  );\n\n  return (\n    <main className={classes.content}>\n      <div className={classes.toolbar} />\n      <div className={classes.messages} ref={messagesRef}>\n        <Box marginTop=\"auto\" marginBottom={1} p={1}>\n          <Grid item container direction=\"column\" spacing={1}>\n            {messages}\n          </Grid>\n        </Box>\n      </div>\n      <Box p={1} paddingTop={0}>\n        <ChatInput client={client} selectedRoom={selectedRoom} />\n      </Box>\n    </main>\n  );\n};\n\nexport default Messages;\n","import React, {\n  useState,\n  useCallback,\n  useEffect,\n  useRef,\n  useLayoutEffect,\n} from 'react';\n\nimport {\n  Typography,\n  AppBar,\n  Toolbar,\n  Drawer,\n  makeStyles,\n  IconButton,\n  Menu,\n  MenuItem,\n  Hidden,\n  useTheme,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  Button,\n  List,\n  ListItem,\n  ListItemText,\n} from '@material-ui/core';\n\nimport {\n  Menu as MenuIcon,\n  Settings as SettingsIcon,\n  Group,\n  Person,\n  PersonAdd,\n  Chat as ChatIcon,\n} from '@material-ui/icons';\n\nimport { DrawerContent } from './DrawerContent';\nimport Messages from './Messages';\n\nconst drawerWidth = 240;\n\nconst useStyles = makeStyles(theme => ({\n  '@global': {\n    // body: {\n    //   height: '100%',\n    // },\n    // html: {\n    //   height: '100%',\n    // },\n    // '#root': {\n    //   height: '100%',\n    // },\n  },\n  root: {\n    display: 'flex',\n    flexGrow: 1,\n    height: '100%',\n  },\n  drawer: {\n    [theme.breakpoints.up('sm')]: {\n      width: drawerWidth,\n      flexShrink: 0,\n    },\n  },\n  appBar: {\n    [theme.breakpoints.up('sm')]: {\n      width: `calc(100% - ${drawerWidth}px)`,\n      marginLeft: drawerWidth,\n    },\n  },\n  menuButton: {\n    marginRight: theme.spacing(2),\n    [theme.breakpoints.up('sm')]: {\n      display: 'none',\n    },\n  },\n  drawerPaper: {\n    width: drawerWidth,\n    position: 'absolute',\n  },\n  title: {\n    flexGrow: 1,\n  },\n}));\n\ntype Props = {\n  client: Client;\n  onLogOut: () => void;\n  rooms: Rooms;\n  user: string;\n  onRoomSelect: (roomName: string | undefined) => void;\n  selectedRoom: string | undefined;\n};\n\nconst Chat: React.FC<Props> = ({\n  client,\n  onLogOut,\n  rooms,\n  user,\n  selectedRoom,\n  onRoomSelect,\n}) => {\n  const messagesRef = useRef<HTMLDivElement>(null);\n\n  const singleRoomLog = selectedRoom\n    ? rooms[selectedRoom]?.events ?? undefined\n    : undefined;\n\n  useLayoutEffect(() => {\n    if (messagesRef.current) {\n      messagesRef.current.scrollTop = messagesRef.current.scrollHeight;\n    }\n  }, [singleRoomLog]);\n\n  useEffect(() => {\n    if (selectedRoom && !rooms[selectedRoom]) {\n      onRoomSelect(undefined);\n    }\n  }, [onRoomSelect, selectedRoom, rooms]);\n\n  const classes = useStyles();\n\n  const theme = useTheme();\n\n  const [drawerOpened, setDrawerOpened] = useState(false);\n\n  const handleDrawerClose = useCallback(() => {\n    setDrawerOpened(false);\n  }, []);\n\n  const handleMenuButtonClick = useCallback(() => {\n    setDrawerOpened(true);\n  }, []);\n\n  const handleRoomSelect = useCallback(\n    roomName => {\n      setDrawerOpened(false);\n      onRoomSelect(roomName);\n    },\n    [onRoomSelect],\n  );\n\n  const [anchorEl, setAnchorEl] = React.useState<null | HTMLElement>(null);\n\n  const open = Boolean(anchorEl);\n\n  const handleMenu = useCallback((event: React.MouseEvent<HTMLElement>) => {\n    setAnchorEl(event.currentTarget);\n  }, []);\n\n  const handleLeaveRoom = useCallback(() => {\n    setAnchorEl(null);\n\n    client\n      .call('leaveRoom', [selectedRoom])\n      .then((res: any) => {\n        console.log('LEAVE ROOM', res);\n      })\n      .catch((err: any) => {\n        console.log('LEAVE ROOM', err);\n      });\n  }, [client, selectedRoom]);\n\n  const handleClose = useCallback(() => {\n    setAnchorEl(null);\n  }, []);\n\n  const [showRoomMembers, setShowRoomMembers] = useState(false);\n\n  const handleShowRoomMembers = useCallback(() => {\n    setAnchorEl(null);\n    setShowRoomMembers(true);\n  }, []);\n\n  const handleShowRoomMembersDialogClose = useCallback(() => {\n    setShowRoomMembers(false);\n  }, []);\n\n  const drawer = (\n    <DrawerContent\n      activeRoom={selectedRoom}\n      rooms={rooms}\n      onRoomSelect={handleRoomSelect}\n      user={user}\n      onLogOut={onLogOut}\n      client={client}\n    />\n  );\n\n  const handleAddClick = useCallback(\n    (userName: string) => {\n      const room = `!${[userName, user].sort().join('!')}`;\n\n      client\n        .call('joinRoom', [room])\n        .then((res: any) => {\n          console.info('ADD CONTACT', res);\n          onRoomSelect(room);\n        })\n        .catch((err: any) => {\n          console.error('ADD CONTACT', err);\n        })\n        .then(() => {\n          setShowRoomMembers(false);\n        });\n    },\n    [client, onRoomSelect, user],\n  );\n\n  return (\n    <div className={classes.root}>\n      <Dialog open={showRoomMembers} onClose={handleShowRoomMembersDialogClose}>\n        <DialogTitle>Room members</DialogTitle>\n        <DialogContent>\n          {selectedRoom && (\n            <List dense>\n              {[...(rooms[selectedRoom]?.users ?? [])].sort().map(u => (\n                <ListItem key={u}>\n                  <ListItemText>{u}</ListItemText>\n                  {u === user ? null : Object.keys(rooms).some(\n                      roomName =>\n                        roomName[0] === '!' && roomName.split('!').includes(u),\n                    ) ? (\n                    <IconButton\n                      edge=\"end\"\n                      onClick={() => {\n                        setShowRoomMembers(false);\n                        onRoomSelect(`!${[u, user].join('!')}`);\n                      }}\n                    >\n                      <ChatIcon />\n                    </IconButton>\n                  ) : (\n                    <IconButton edge=\"end\" onClick={() => handleAddClick(u)}>\n                      <PersonAdd />\n                    </IconButton>\n                  )}\n                </ListItem>\n              ))}\n            </List>\n          )}\n        </DialogContent>\n        <DialogActions>\n          <Button\n            type=\"button\"\n            autoFocus\n            onClick={handleShowRoomMembersDialogClose}\n            color=\"primary\"\n          >\n            Close\n          </Button>\n        </DialogActions>{' '}\n      </Dialog>\n\n      <AppBar position=\"absolute\" className={classes.appBar}>\n        <Toolbar>\n          <IconButton\n            edge=\"start\"\n            className={classes.menuButton}\n            color=\"inherit\"\n            aria-label=\"open drawer\"\n            onClick={handleMenuButtonClick}\n          >\n            <MenuIcon />\n          </IconButton>\n          <Typography variant=\"h6\" className={classes.title}>\n            {selectedRoom ? (\n              <>\n                {selectedRoom.startsWith('!') ? (\n                  <Person fontSize=\"inherit\" />\n                ) : (\n                  <Group fontSize=\"inherit\" />\n                )}{' '}\n                {selectedRoom.startsWith('!')\n                  ? selectedRoom.replace(`!${user}`, '').slice(1)\n                  : selectedRoom}\n              </>\n            ) : (\n              <i>No chat active</i>\n            )}\n          </Typography>\n          {selectedRoom && (\n            <>\n              <IconButton\n                aria-label=\"account of current user\"\n                aria-controls=\"menu-appbar\"\n                aria-haspopup=\"true\"\n                onClick={handleMenu}\n                color=\"inherit\"\n              >\n                <SettingsIcon />\n              </IconButton>\n              <Menu\n                id=\"menu-appbar\"\n                anchorEl={anchorEl}\n                anchorOrigin={{\n                  vertical: 'top',\n                  horizontal: 'right',\n                }}\n                keepMounted\n                transformOrigin={{\n                  vertical: 'top',\n                  horizontal: 'right',\n                }}\n                open={open}\n                onClose={handleClose}\n              >\n                <MenuItem onClick={handleLeaveRoom}>\n                  {selectedRoom.startsWith('!')\n                    ? 'Forget contact'\n                    : 'Leave room'}\n                </MenuItem>\n                {!selectedRoom.startsWith('!') && (\n                  <MenuItem onClick={handleShowRoomMembers}>\n                    Show room members\n                  </MenuItem>\n                )}\n              </Menu>\n            </>\n          )}\n        </Toolbar>\n      </AppBar>\n\n      <nav className={classes.drawer} aria-label=\"mailbox folders\">\n        {/* The implementation can be swapped with js to avoid SEO duplication of links. */}\n        <Hidden smUp implementation=\"css\">\n          <Drawer\n            variant=\"temporary\"\n            anchor={theme.direction === 'rtl' ? 'right' : 'left'}\n            open={drawerOpened}\n            onClose={handleDrawerClose}\n            classes={{\n              paper: classes.drawerPaper,\n            }}\n            ModalProps={{\n              keepMounted: true, // Better open performance on mobile.\n            }}\n          >\n            {drawer}\n          </Drawer>\n        </Hidden>\n        <Hidden xsDown implementation=\"css\">\n          <Drawer\n            classes={{\n              paper: classes.drawerPaper,\n            }}\n            variant=\"permanent\"\n            open\n          >\n            {drawer}\n          </Drawer>\n        </Hidden>\n      </nav>\n\n      {selectedRoom && (\n        <Messages\n          client={client}\n          roomEvents={rooms[selectedRoom]?.events ?? []}\n          selectedRoom={selectedRoom}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default Chat;\n","import React, { useCallback, useState, FormEvent, ChangeEvent } from 'react';\nimport {\n  Container,\n  makeStyles,\n  Avatar,\n  TextField,\n  Typography,\n  // FormControlLabel,\n  // Checkbox,\n  Button,\n  // Box,\n  Grid,\n  Link,\n} from '@material-ui/core';\nimport {\n  LockOutlined,\n  // Copyright,\n} from '@material-ui/icons';\n\ntype Props = {\n  onLogin: (login: string, password: string) => void;\n};\n\nconst useStyles = makeStyles(theme => ({\n  paper: {\n    marginTop: theme.spacing(8),\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center',\n  },\n  avatar: {\n    margin: theme.spacing(1),\n    backgroundColor: theme.palette.secondary.main,\n  },\n  form: {\n    width: '100%', // Fix IE 11 issue.\n    marginTop: theme.spacing(1),\n  },\n  submit: {\n    margin: theme.spacing(3, 0, 2),\n  },\n}));\n\nexport const Login: React.FC<Props> = ({ onLogin }) => {\n  const classes = useStyles();\n\n  const [user, setUser] = useState('');\n\n  const [password, setPassword] = useState('');\n\n  const handleSubmit = useCallback(\n    (e: FormEvent) => {\n      e.preventDefault();\n      onLogin(user, password);\n    },\n    [onLogin, user, password],\n  );\n\n  const handleUserChange = useCallback(\n    (e: ChangeEvent<HTMLInputElement>) => {\n      setUser(e.target.value);\n    },\n    [setUser],\n  );\n\n  const handlePasswordChange = useCallback(\n    (e: ChangeEvent<HTMLInputElement>) => {\n      setPassword(e.target.value);\n    },\n    [setPassword],\n  );\n\n  return (\n    <Container component=\"main\" maxWidth=\"xs\">\n      <div className={classes.paper}>\n        <Avatar className={classes.avatar}>\n          <LockOutlined />\n        </Avatar>\n        <Typography component=\"h1\" variant=\"h5\">\n          Sign in\n        </Typography>\n        <form className={classes.form} noValidate onSubmit={handleSubmit}>\n          <TextField\n            variant=\"outlined\"\n            margin=\"normal\"\n            required\n            fullWidth\n            label=\"Username\"\n            name=\"username\"\n            autoComplete=\"username\"\n            autoFocus\n            value={user}\n            onChange={handleUserChange}\n          />\n          <TextField\n            variant=\"outlined\"\n            margin=\"normal\"\n            required\n            fullWidth\n            name=\"password\"\n            label=\"Password\"\n            type=\"password\"\n            autoComplete=\"current-password\"\n            value={password}\n            onChange={handlePasswordChange}\n          />\n          {/* <FormControlLabel\n            control={<Checkbox value=\"remember\" color=\"primary\" />}\n            label=\"Remember me\"\n          /> */}\n          <Button\n            type=\"submit\"\n            fullWidth\n            variant=\"contained\"\n            color=\"primary\"\n            className={classes.submit}\n          >\n            Sign In\n          </Button>\n          <Grid container>\n            <Grid item xs>\n              <Link href=\"#\" variant=\"body2\">\n                Forgot password?\n              </Link>\n            </Grid>\n            <Grid item>\n              <Link href=\"#\" variant=\"body2\">\n                Don't have an account? Sign Up\n              </Link>\n            </Grid>\n          </Grid>\n        </form>\n      </div>\n      {/* <Box mt={8}>\n        <Copyright />\n      </Box> */}\n    </Container>\n  );\n};\n","import { produce, enableMapSet } from 'immer';\n\nenableMapSet();\n\nexport type ConnectionState = 'connecting' | 'connected' | 'closing' | 'closed';\n\nexport type State = {\n  loginInProgress: boolean;\n  client: Client | undefined;\n  authData: string | undefined;\n  rooms: Rooms;\n  connectionState: ConnectionState;\n  connectionReason: number | undefined;\n  selectedRoom: string | undefined;\n};\n\nexport type InitAction = {\n  type: 'init';\n};\n\nexport type StartLoginAction = {\n  type: 'startLogin';\n};\n\nexport type StopLoginAction = {\n  type: 'stopLogin';\n};\n\nexport type SetClientAction = {\n  type: 'setClient';\n  payload: Client | undefined;\n};\n\nexport type SetAuthDataAction = {\n  type: 'setAuthData';\n  payload: string | undefined;\n};\n\nexport type AddRoomEventAction = {\n  type: 'addRoomEvent';\n  payload: RoomEvent;\n};\n\nexport type UserJoinedAction = {\n  type: 'userJoined';\n  payload: { user: string; room: string; lastRead: number };\n};\n\nexport type UserLeftAction = {\n  type: 'userLeft';\n  payload: { user: string; room: string };\n};\n\nexport type SetConnectionState = {\n  type: 'setConnectionState';\n  payload: { state: ConnectionState; code?: number };\n};\n\nexport type SetLastRead = {\n  type: 'setLastRead';\n  payload: {\n    room: string;\n    lastRead: number;\n  };\n};\n\nexport type SelectRoom = {\n  type: 'selectRoom';\n  payload: string | undefined;\n};\n\nexport type Action =\n  | InitAction\n  | StartLoginAction\n  | StopLoginAction\n  | SetClientAction\n  | SetAuthDataAction\n  | AddRoomEventAction\n  | UserJoinedAction\n  | UserLeftAction\n  | SetConnectionState\n  | SetLastRead\n  | SelectRoom;\n\nexport const initialState: State = {\n  loginInProgress: false,\n  client: undefined,\n  authData: undefined,\n  rooms: {},\n  connectionState: 'closed',\n  connectionReason: undefined,\n  selectedRoom: undefined,\n};\n\nexport function reducer(state: State, action: Action) {\n  return produce(state, draft => {\n    switch (action.type) {\n      case 'init':\n        Object.assign(draft, initialState);\n        break;\n\n      case 'startLogin':\n        draft.loginInProgress = true;\n        break;\n\n      case 'stopLogin':\n        draft.loginInProgress = false;\n        break;\n\n      case 'setClient':\n        draft.client = action.payload;\n        break;\n\n      case 'setAuthData':\n        draft.authData = action.payload;\n        break;\n\n      case 'addRoomEvent':\n        draft.rooms[action.payload.room].events.push(action.payload);\n        break;\n\n      case 'userJoined': {\n        let item = draft.rooms[action.payload.room];\n\n        if (!item) {\n          item = { users: new Set(), lastRead: 0, events: [] };\n          draft.rooms[action.payload.room] = item;\n        }\n\n        item.users.add(action.payload.user);\n        item.lastRead = action.payload.lastRead;\n\n        break;\n      }\n\n      case 'userLeft': {\n        if (action.payload.user === draft.authData) {\n          delete draft.rooms[action.payload.room];\n          return;\n        }\n\n        let item = draft.rooms[action.payload.room];\n\n        if (item) {\n          item.users.delete(action.payload.user);\n        }\n\n        break;\n      }\n\n      case 'setConnectionState':\n        draft.connectionState = action.payload.state;\n        draft.connectionReason = action.payload.code;\n        break;\n\n      case 'setLastRead':\n        draft.rooms[action.payload.room].lastRead = action.payload.lastRead;\n        break;\n\n      case 'selectRoom':\n        draft.selectedRoom = action.payload;\n        break;\n\n      default:\n        throw Error('unknown action');\n    }\n  });\n}\n","import 'typeface-roboto';\nimport React, { useEffect, useCallback, useReducer } from 'react';\nimport Chat from './Chat';\nimport { Login } from './Login';\nimport { red } from '@material-ui/core/colors';\n\nimport {\n  ThemeProvider,\n  createMuiTheme,\n  Backdrop,\n  Paper,\n  Box,\n  makeStyles,\n  Theme,\n  createStyles,\n  CssBaseline,\n} from '@material-ui/core';\n\nimport { reducer, initialState } from './reducer';\n\nconst theme = createMuiTheme({\n  palette: {\n    primary: red,\n  },\n});\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    backdrop: {\n      zIndex: theme.zIndex.drawer + 1,\n      color: '#fff',\n    },\n  }),\n);\n\nexport const App: React.FC = () => {\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  useEffect(() => {\n    if (state.client !== undefined) {\n      return;\n    }\n\n    dispatch({ type: 'setConnectionState', payload: { state: 'connecting' } });\n\n    const ws = new WebSocket(\n      `${window.location.protocol.replace('http', 'ws')}//${\n        window.location.port === '3000' || window.location.port === '6060'\n          ? 'localhost:8080'\n          : window.location.host\n      }/chat`,\n    );\n\n    const calls = new Map<\n      number,\n      { resolve: (result: any) => void; reject: (err: any) => void }\n    >();\n\n    let callId = 1;\n\n    function call(method: string, params: object | any[]) {\n      return new Promise((resolve, reject) => {\n        ws.send(\n          JSON.stringify({\n            jsonrpc: '2.0',\n            id: callId,\n            method,\n            params,\n          }),\n        );\n\n        calls.set(callId, { resolve, reject });\n\n        callId++;\n      });\n    }\n\n    ws.addEventListener('open', () => {\n      console.info('WS Open');\n\n      dispatch({ type: 'setConnectionState', payload: { state: 'connected' } });\n\n      const user = window.localStorage.getItem('user');\n\n      if (user) {\n        dispatch({ type: 'startLogin' });\n\n        call('login', [user])\n          .then(() => {\n            dispatch({ type: 'setAuthData', payload: user });\n          })\n          .finally(() => {\n            dispatch({ type: 'stopLogin' });\n          });\n      }\n    });\n\n    ws.addEventListener('message', event => {\n      const { id, result, error, method, params, jsonrpc } = JSON.parse(\n        event.data,\n      );\n\n      if (jsonrpc !== '2.0') {\n        return;\n      }\n\n      if (method && params) {\n        console.log('METHOD', method, params);\n\n        if (method === 'joinRoom') {\n          dispatch({ type: 'userJoined', payload: params });\n        } else if (method === 'leaveRoom') {\n          dispatch({ type: 'userLeft', payload: params });\n        } else if (method === 'roomEvent') {\n          dispatch({ type: 'addRoomEvent', payload: params });\n        } else if (method === 'lastRead') {\n          dispatch({ type: 'setLastRead', payload: params });\n        }\n      } else if (id !== undefined && (error || result !== undefined)) {\n        const call = calls.get(id);\n\n        if (call) {\n          calls.delete(id);\n\n          if (error) {\n            call.reject(error);\n          } else {\n            call.resolve(result);\n          }\n        }\n      }\n    });\n\n    ws.addEventListener('error', event => {\n      console.error('WS Error', event);\n    });\n\n    let timeoutRef: number | undefined;\n\n    ws.addEventListener('close', event => {\n      console.info('WS Close', event);\n\n      for (const call of calls.values()) {\n        call.reject(new Error('connection closed'));\n      }\n\n      dispatch({\n        type: 'setConnectionState',\n        payload: { state: 'closed', code: event.code },\n      });\n\n      if (event.code !== 1000 && event.code !== 1005) {\n        timeoutRef = window.setTimeout(() => {\n          timeoutRef = undefined;\n          dispatch({ type: 'init' });\n        }, 1000);\n      }\n    });\n\n    dispatch({ type: 'setClient', payload: { ws, call } });\n\n    return () => {\n      // ws.close(); // TODO\n      window.clearTimeout(timeoutRef);\n    };\n  }, [state.client]);\n\n  useEffect(() => {\n    if (state.client && state.selectedRoom) {\n      const room = state.rooms[state.selectedRoom];\n\n      if (room && room.events.length) {\n        const lastRead = room.events[room.events.length - 1].ts;\n\n        if (lastRead !== room.lastRead) {\n          state.client.call('setRoomLastRead', {\n            room: state.selectedRoom,\n            lastRead,\n          });\n        }\n      }\n    }\n  }, [state.client, state.selectedRoom, state.rooms]);\n\n  const handleLogin = useCallback(\n    (user: string, password: string) => {\n      if (!state.client) {\n        throw new Error('no client');\n      }\n\n      dispatch({ type: 'startLogin' });\n\n      state.client\n        .call('login', [user])\n        .then(() => {\n          window.localStorage.setItem('user', user);\n          dispatch({ type: 'setAuthData', payload: user });\n        })\n        .finally(() => {\n          dispatch({ type: 'stopLogin' });\n        });\n    },\n    [state.client],\n  );\n\n  const handleLogOut = useCallback(() => {\n    const client = state.client;\n\n    if (client) {\n      client.call('logout', []).then(() => {\n        dispatch({ type: 'setConnectionState', payload: { state: 'closing' } });\n\n        client?.ws.close();\n\n        window.localStorage.removeItem('user');\n\n        dispatch({ type: 'init' });\n      });\n    }\n  }, [state.client]);\n\n  const connSpecial = ['connecting', 'closing', 'closed'].includes(\n    state.connectionState,\n  );\n\n  const special = connSpecial\n    ? stateMapping[state.connectionState]\n    : state.loginInProgress\n    ? 'Logging in...'\n    : !state.client\n    ? 'Loading...'\n    : null;\n\n  const classes = useStyles();\n\n  const handleRoomSelect = useCallback((room: string | undefined) => {\n    dispatch({ type: 'selectRoom', payload: room });\n  }, []);\n\n  return (\n    <ThemeProvider theme={theme}>\n      <CssBaseline />\n\n      <Backdrop open={!!special} className={classes.backdrop}>\n        <Paper elevation={2}>\n          <Box padding={2}>{special}</Box>\n        </Paper>\n      </Backdrop>\n\n      {connSpecial || !state.client ? null : state.authData ? (\n        <Chat\n          client={state.client}\n          onLogOut={handleLogOut}\n          rooms={state.rooms}\n          user={state.authData}\n          onRoomSelect={handleRoomSelect}\n          selectedRoom={state.selectedRoom}\n        />\n      ) : (\n        <Login onLogin={handleLogin} />\n      )}\n    </ThemeProvider>\n  );\n};\n\nconst stateMapping = {\n  closed: 'Reconnecting...',\n  connecting: 'Reconnecting...',\n  closing: 'Closing...',\n  connected: 'Connected.',\n};\n"],"sourceRoot":""}